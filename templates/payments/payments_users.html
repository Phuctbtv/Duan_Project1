{% extends 'users/quanlytaikhoan.html' %}

{% load static %}
{% block users %}

    <!-- Progress Steps -->
    <div class="bg-white border-b shadow-sm">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-center">
                <div class="flex items-center space-x-8">
                    <!-- Step 1 -->
                    <div class="flex items-center">
                        <div id="step-1" class="step-indicator w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold active">
                            1
                        </div>
                        <div class="ml-3">
                            <div class="text-sm font-semibold text-blue-600">Ch·ªçn s·∫£n ph·∫©m</div>
                            <div class="text-xs text-gray-500">L·ª±a ch·ªçn g√≥i b·∫£o hi·ªÉm</div>
                        </div>
                    </div>


                    <div class="w-16 h-1 bg-gray-300 rounded">
                        <div id="progress-1-2" class="h-full bg-blue-600 rounded transition-all duration-500" style="width: 0%"></div>
                    </div>



                    <!-- Step 2 -->
                    <div class="flex items-center">
                        <div id="step-2" class="step-indicator w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center text-gray-500 font-bold">
                            2
                        </div>
                        <div class="ml-3">
                            <div class="text-sm font-semibold text-gray-500">Th√¥ng tin c√° nh√¢n</div>
                            <div class="text-xs text-gray-400">ƒêi·ªÅn th√¥ng tin ƒë·ªÉ t√≠nh ph√≠</div>
                        </div>
                    </div>

                    <div class="w-16 h-1 bg-gray-300 rounded">
                        <div id="progress-2-3" class="h-full bg-blue-600 rounded transition-all duration-500" style="width: 0%"></div>
                    </div>

                    <!-- Step 3 -->
                    <div class="flex items-center">
                        <div id="step-3" class="step-indicator w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center text-gray-500 font-bold">
                            3
                        </div>
                        <div class="ml-3">
                            <div class="text-sm font-semibold text-gray-500">X√°c nh·∫≠n ph√≠</div>
                            <div class="text-xs text-gray-400">Ki·ªÉm tra ph√≠ b·∫£o hi·ªÉm</div>
                        </div>
                    </div>

                    <div class="w-16 h-1 bg-gray-300 rounded">
                        <div id="progress-3-4" class="h-full bg-blue-600 rounded transition-all duration-500" style="width: 0%"></div>
                    </div>

                    <!-- Step 4 -->
                    <div class="flex items-center">
                        <div id="step-4" class="step-indicator w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center text-gray-500 font-bold">
                            4
                        </div>
                        <div class="ml-3">
                            <div class="text-sm font-semibold text-gray-500">Thanh to√°n</div>
                            <div class="text-xs text-gray-400">Ho√†n t·∫•t thanh to√°n</div>
                        </div>
                    </div>

                    <div class="w-16 h-1 bg-gray-300 rounded">
                        <div id="progress-4-5" class="h-full bg-blue-600 rounded transition-all duration-500" style="width: 0%"></div>
                    </div>

                    <!-- Step 5 -->
                    <div class="flex items-center">
                        <div id="step-5" class="step-indicator w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center text-gray-500 font-bold">
                            5
                        </div>
                        <div class="ml-3">
                            <div class="text-sm font-semibold text-gray-500">H·ª£p ƒë·ªìng</div>
                            <div class="text-xs text-gray-400">Sinh h·ª£p ƒë·ªìng b·∫£o hi·ªÉm</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Step 1: Product Selection -->

        <div id="step-1-content" class="step-content">
            {% if not recent_products %}
            <div class="text-center mt-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-4">B·∫°n ch∆∞a xem s·∫£n ph·∫©m n√†o g·∫ßn ƒë√¢y</h1>
                <a href="{% url 'custom_products_user' %}" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700">
                    <i class="fas fa-list mr-2"></i> Xem t·∫•t c·∫£ s·∫£n ph·∫©m b·∫£o hi·ªÉm
                </a>
            </div>
            {% elif recent_products %}
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-4">Ch·ªçn s·∫£n ph·∫©m b·∫£o hi·ªÉm b·∫°n ƒë√£ xem g·∫ßn ƒë√¢y</h1>
                <p class="text-gray-600">L·ª±a ch·ªçn g√≥i b·∫£o hi·ªÉm ph√π h·ª£p v·ªõi nhu c·∫ßu c·ªßa b·∫°n</p>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                {% for product in recent_products %}
                <div class="product-card bg-white rounded-2xl shadow-lg p-6 border-2 border-transparent hover:border-blue-500 cursor-pointer"
                     onclick="selectProduct('{{ product.id }}')">
                    <!-- Icon + T√™n -->
                    <div class="text-center mb-6">
                        <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-heartbeat text-blue-600 text-3xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">{{ product.product_name }}</h3>
                        <p class="text-gray-600 text-sm">{{ product.description|truncatewords:10 }}</p>
                    </div>

                    <!-- M·ªôt s·ªë th√¥ng tin c∆° b·∫£n -->
                    <div class="space-y-3 mb-6">
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            <span>{{ product.coverage_details|truncatewords:12 }}</span>
                        </div>
                    </div>

                    <!-- Ph√≠ c∆° b·∫£n -->
                    <div class="text-center mb-4">
                        <div class="text-2xl font-bold text-blue-600">
                            Ph√≠ t·ª´ {{ product.premium_base_amount_short }} {{ product.currency }}/nƒÉm
                        </div>
                        <div class="text-sm text-gray-500">Ph√≠ ch√≠nh x√°c s·∫Ω ƒë∆∞·ª£c t√≠nh sau</div>
                    </div>

                    <!-- Tag -->
                    <div class="bg-blue-50 rounded-lg p-3 text-center">
                        <span class="text-blue-600 font-semibold text-sm">B·∫°n v·ª´a xem</span>
                    </div>
                </div>
                {% endfor %}
            </div>
                        <!-- Continue Button -->
            <div class="text-center">
                <button id="continue-step-1" onclick="showInfo()" class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-8 py-4 rounded-xl font-bold text-lg hover:from-blue-700 hover:to-indigo-700 transition duration-300 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    <i class="fas fa-arrow-right mr-2"></i>
                    Ti·∫øp t·ª•c
                </button>
                <p class="text-sm text-gray-500 mt-2">Vui l√≤ng ch·ªçn m·ªôt s·∫£n ph·∫©m ƒë·ªÉ ti·∫øp t·ª•c</p>
            </div>
            {% endif %}



        </div>

        <!-- Step 2: Health Insurance Information -->
        <div id="step-2-content" class="step-content hidden">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-4">Th√¥ng tin c√° nh√¢n & s·ª©c kh·ªèe</h1>
                <p class="text-gray-600">ƒêi·ªÅn th√¥ng tin ƒë·ªÉ h·ªá th·ªëng t√≠nh to√°n ph√≠ v√† ph·ª• ph√≠ b·∫£o hi·ªÉm</p>
            </div>

            <div class="grid lg:grid-cols-3 gap-8">
                <!-- Form -->
                <div class="lg:col-span-2">
                    <form id="health-info-form" class="bg-white rounded-2xl shadow-lg p-8" onsubmit="return false;">
                        <div class="grid md:grid-cols-2 gap-6">
                        {% csrf_token %}
                            <!-- Th√¥ng tin c∆° b·∫£n -->
                            <div class="md:col-span-2">
                                <h3 class="text-lg font-bold text-gray-800 mb-4">Th√¥ng tin c∆° b·∫£n</h3>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">H·ªç v√† t√™n *</label>
                                <input type="text" id="fullName" name="fullname" required class="form-input w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Ng√†y sinh *</label>
                                <input type="date" id="birthDate" required name="birthDate"
                                       class="form-input w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                       onchange="calculateAge('birthDate','ageDisplay')">
                            </div>

                            <div class="mt-4">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Tu·ªïi</label>
                                <input type="text" id="ageDisplay" name="age"
                                       class="form-input w-full px-4 py-3 border rounded-lg bg-gray-100"
                                       readonly>
                            </div>
                            <div class="mt-4">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">CCCD/CMND: </label>
                                <input type="number" id="id_card_number" name="id_card_number"
                                       class="form-input w-full px-4 py-3 border rounded-lg bg-gray-100"
                                       >
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Gi·ªõi t√≠nh *</label>
                                <select id="gender" required name="gender" class="form-input w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500" aria-readonly="true">
                                    <option value="">Ch·ªçn</option>
                                    <option value="male">Nam</option>
                                    <option value="female">N·ªØ</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Ngh·ªÅ nghi·ªáp *</label>
                                <input type="text" id="occupation" name="occupation" required class="form-input w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>

                            <!-- Th√¥ng tin li√™n h·ªá ng∆∞·ªùi mua b·∫£o hi·ªÉm -->
                            <div class="md:col-span-2 mt-6">
                                <h3 class="text-lg font-bold text-gray-800 mb-4">Th√¥ng tin li√™n h·ªá</h3>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">S·ªë ƒëi·ªán tho·∫°i *</label>
                                <input type="tel" id="phone" name="phone" required class="form-input w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Email *</label>
                                <input type="email" id="email" name="email" required class="form-input w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">ƒê·ªãa ch·ªâ *</label>
                                <input type="text" id="address" name="address" required placeholder="S·ªë nh√†, ƒë∆∞·ªùng, qu·∫≠n, t·ªânh" class="form-input w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 ">
                                <div>
                                  <label for="id_cccd_front" class="block text-sm font-medium text-gray-700">·∫¢nh CCCD m·∫∑t tr∆∞·ªõc</label>
                                  <input type="file" name="cccd_front" id="id_cccd_front" accept="image/*"
                                         class="mt-1 block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50" required>
                                </div>

                                <div>
                                  <label for="id_cccd_back" class="block text-sm font-medium text-gray-700">·∫¢nh CCCD m·∫∑t sau</label>
                                  <input type="file" name="cccd_back" id="id_cccd_back" accept="image/*"
                                         class="mt-1 block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50" required>
                                </div>
                            </div>

                            <!-- Ng∆∞·ªùi th·ª• h∆∞·ªüng -->
                            <div class="md:col-span-2 mt-6">
                                <h4 class="text-lg font-semibold text-gray-800 mb-4">Th√¥ng tin ng∆∞·ªùi ƒë∆∞·ª£c b·∫£o hi·ªÉm</h4>
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <label class="flex items-center mb-4">
                                        <input type="checkbox" id="sameBeneficiary" class="rounded text-blue-600 mr-3">
                                        <span class="text-gray-700">Ng∆∞·ªùi mua b·∫£o hi·ªÉm c≈©ng l√† ng∆∞·ªùi ƒë∆∞·ª£c b·∫£o hi·ªÉm</span>
                                    </label>

                                    <div id="beneficiaryInfo" class="grid md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">H·ªç t√™n ng∆∞·ªùi ƒë∆∞·ª£c b·∫£o hi·ªÉm</label>
                                            <input type="text" id="fullname_benefic" name="fullname_benefic" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="H·ªç v√† t√™n">
                                        </div>
                                        <div  >
                                            <label class="block text-sm font-medium text-gray-700 mb-2">M·ªëi quan h·ªá</label>
                                            <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" id="relationship_to_customer" name="relationship_to_customer" >
                                                <option value="">Ch·ªçn m·ªëi quan h·ªá</option>
                                                <option value="spouse">V·ª£/Ch·ªìng</option>
                                                <option value="child">Con</option>
                                                <option value="parent">Cha/M·∫π</option>
                                                <option value="sibling">Anh/Ch·ªã/Em</option>
                                                <option value="me">B·∫£n th√¢n</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ng√†y sinh *</label>
                                            <input type="date" name="birthDate_benefic" id="birthDate_benefic" required
                                                   class="form-input w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                                   onchange="calculateAge('birthDate_benefic','ageDisplay_benefic')">
                                        </div>
                                        <div class="mt-4">
                                            <label class="block text-sm font-semibold text-gray-700 mb-2">Tu·ªïi</label>
                                            <input type="text" id="ageDisplay_benefic" name="ageDisplay_benefic"
                                                   class="form-input w-full px-4 py-3 border rounded-lg bg-gray-100"
                                                   readonly>
                                        </div>
                                        <div class="mt-4">
                                            <label class="block text-sm font-semibold text-gray-700 mb-2">CCCD/CMND:</label>
                                            <input type="number" id="id_card_number_benefic" name="id_card_number_benefic"
                                                   class="form-input w-full px-4 py-3 border rounded-lg bg-gray-100"
                                                   >
                                        </div>
                                    </div>
                                </div>
                            </div>

                             <!-- Th√¥ng tin s·ª©c kh·ªèe -->
                            <div class="md:col-span-2 mt-6">
                                <h3 class="text-lg font-bold text-gray-800 mb-4">Th√¥ng tin s·ª©c kh·ªèe</h3>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Chi·ªÅu cao (cm) *</label>
                                <input type="number" id="height" name="height" class="form-input w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">C√¢n n·∫∑ng (kg) *</label>
                                <input type="number" id="weight" name="weight" required class="form-input w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">H√∫t thu·ªëc *</label>
                                <select id="smoking"  name="smoker" required class="form-input w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">Ch·ªçn</option>
                                    <option value="never">Kh√¥ng h√∫t</option>
                                    <option value="former">ƒê√£ b·ªè</option>
                                    <option value="current">ƒêang h√∫t</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">U·ªëng r∆∞·ª£u/bia *</label>
                                <select id="alcohol" name="alcohol" required class="form-input w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">Ch·ªçn</option>
                                    <option value="no">Kh√¥ng</option>
                                    <option value="sometimes">Th·ªânh tho·∫£ng</option>

                                </select>
                            </div>

                            <!-- C√¢u h·ªèi s·ª©c kh·ªèe -->
                           <div class="md:col-span-2 mt-6">
                                <h3 class="text-lg font-bold text-gray-800 mb-4">Ti·ªÅn s·ª≠ b·ªánh l√Ω</h3>
                                <div class="space-y-3">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="conditions" value="ti·ªÉu_ƒë∆∞·ªùng" class="mr-2"> Ti·ªÉu ƒë∆∞·ªùng
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="conditions" value="tim_m·∫°ch_cao_huy·∫øt_√°p" class="mr-2"> Tim m·∫°ch / Cao huy·∫øt √°p
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="conditions" value="ung_th∆∞_th·∫≠n_gan_ph·ªïi" class="mr-2"> Ung th∆∞ / Th·∫≠n / Gan / Ph·ªïi
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="conditions" value="ƒëang_ƒëi·ªÅu_tr·ªã_d√†i_h·∫°n" class="mr-2"> ƒêang ƒëi·ªÅu tr·ªã d√†i h·∫°n
                                    </label>
                                </div>
                            </div>


                        </div>
                        <div class="border-t border-gray-300 my-4"></div>
                          <h3 class="text-lg font-semibold text-gray-800 mb-2">X√°c th·ª±c danh t√≠nh (eKYC)</h3>

                          <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                              <label for="id_cccd_front" class="block text-sm font-medium text-gray-700">·∫¢nh CCCD m·∫∑t tr∆∞·ªõc</label>
                              <input type="file" name="cccd_front_policyHolder" accept="image/*"
                                     class="mt-1 block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50" required>
                            </div>

                            <div>
                              <label for="id_cccd_back" class="block text-sm font-medium text-gray-700">·∫¢nh CCCD m·∫∑t sau</label>
                              <input type="file" name="cccd_back_policyHolder" accept="image/*"
                                     class="mt-1 block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50" required>
                            </div>

                            <div>
                              <label for="id_selfie_policyHolder" class="block text-sm font-medium text-gray-700">·∫¢nh selfie c·∫ßm CCCD</label>
                              <input type="file" name="selfie" id="id_selfie_policyHolder" accept="image/*"
                                     class="mt-1 block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50" required>
                            </div>
                          <div>
                              <label for="id_selfie_policyHolder" class="block text-sm font-medium text-gray-700">Gi·∫•y kh√°m s·ª©c kh·ªèe</label>
                              <input type="file" name="health_certificate" accept="image/*"
                                     class="mt-1 block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50" required>
                            </div>
                          </div>
                        <!-- Buttons -->
                        <div class="mt-8 flex justify-between">
                            <button type="button" onclick="goToStep(1)" class="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-semibold hover:bg-gray-300">
                                <i class="fas fa-arrow-left mr-2"></i> Quay l·∫°i
                            </button>
                            <button onclick="submitToDjangoForCalculation()"  type="button" class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-8 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-indigo-700">
                                <i class="fas fa-calculator mr-2"></i> T√≠nh ph√≠ b·∫£o hi·ªÉm
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Info Panel -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-2xl shadow-lg p-6 sticky top-24">
                        <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-box-open text-blue-600 mr-2"></i> S·∫£n ph·∫©m ƒë√£ ch·ªçn
                        </h3>
                        <div id="product-summary-step2" class="space-y-4">
                            <p class="text-sm text-gray-500 italic text-center">Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o ƒë∆∞·ª£c ch·ªçn</p>
                        </div>
                        <div class="mt-4">
                            <button onclick="goToStep(1)" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-800 py-2 px-4 rounded-lg text-sm font-medium">
                                <i class="fas fa-arrow-left mr-1"></i> Ch·ªçn s·∫£n ph·∫©m kh√°c
                            </button>
                        </div>
                        <div class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-100">
                            <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                                <i class="fas fa-info-circle text-blue-600 mr-2"></i> L∆∞u √Ω quan tr·ªçng
                            </h4>
                            <ul class="text-sm text-gray-600 space-y-2">
                                <li>‚Ä¢ Th√¥ng tin ch√≠nh x√°c gi√∫p t√≠nh ph√≠ ƒë√∫ng</li>
                                <li>‚Ä¢ Ph√≠ b·∫£o hi·ªÉm ph·ª• thu·ªôc v√†o s·ª©c kh·ªèe & l·ªëi s·ªëng</li>
                                <li>‚Ä¢ Khai b√°o sai c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn b·ªìi th∆∞·ªùng</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Step 3: Premium Calculation -->
        <div id="step-3-content" class="step-content hidden">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-4">Ph√≠ b·∫£o hi·ªÉm c·ªßa b·∫°n</h1>
                <p class="text-gray-600">H·ªá th·ªëng ƒë√£ t√≠nh to√°n ph√≠ b·∫£o hi·ªÉm d·ª±a tr√™n th√¥ng tin b·∫°n cung c·∫•p</p>
            </div>

            <div class="grid lg:grid-cols-3 gap-8">
                <!-- Premium Details -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-2xl shadow-lg p-8">
                        <div class="text-center mb-8">
                            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-calculator text-green-600 text-3xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">Ph√≠ b·∫£o hi·ªÉm ƒë√£ ƒë∆∞·ª£c t√≠nh to√°n</h3>
                            <div id="calculated-premium" class="text-4xl font-bold text-green-600 mb-2">0 VNƒê</div>
                            <div class="text-sm text-gray-500">Ph√≠ h√†ng nƒÉm (ƒë√£ bao g·ªìm VAT)</div>
                        </div>

                        <!-- Premium Breakdown -->
                        <div id="premium-breakdown" class="bg-gray-50 rounded-xl p-6 mb-8">
                            <h4 class="font-bold text-gray-800 mb-4">Chi ti·∫øt t√≠nh ph√≠</h4>
                            <div class="space-y-3">
                                <!-- Breakdown items will be inserted here -->
                            </div>
                        </div>

                        <!-- Risk Factors -->
                        <div id="risk-factors" class="mb-8">
                            <h4 class="font-bold text-gray-800 mb-4">C√°c y·∫øu t·ªë ·∫£nh h∆∞·ªüng ƒë·∫øn ph√≠</h4>
                            <div class="grid md:grid-cols-2 gap-4">
                                <!-- Risk factors will be inserted here -->
                            </div>
                        </div>

                        <!-- Coverage Details -->
                        <div class="bg-blue-50 rounded-xl p-6 mb-8">
                            <h4 class="font-bold text-gray-800 mb-4">Quy·ªÅn l·ª£i b·∫£o hi·ªÉm</h4>
                            <div id="coverage-details" class="space-y-2">
                                <!-- Coverage details will be inserted here -->
                            </div>
                        </div>

                        <div class="flex justify-between">
                            <button type="button" onclick="goToStep(2)" class="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-semibold hover:bg-gray-300 transition duration-200">
                                <i class="fas fa-arrow-left mr-2"></i>
                                S·ª≠a th√¥ng tin
                            </button>
                            <button onclick="goToStep(4)" class="bg-gradient-to-r from-green-600 to-emerald-600 text-white px-8 py-3 rounded-lg font-semibold hover:from-green-700 hover:to-emerald-700 transition duration-300">
                                <i class="fas fa-arrow-right mr-2"></i>
                                X√°c nh·∫≠n v√† thanh to√°n
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Summary -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-2xl shadow-lg p-6 sticky top-24">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Th√¥ng tin kh√°ch h√†ng</h3>
                        <div id="customer-summary">
                            <!-- Customer summary will be inserted here -->
                        </div>

                        <div class="mt-6 p-4 bg-yellow-50 rounded-lg">
                            <h4 class="font-semibold text-gray-800 mb-2">‚ö†Ô∏è L∆∞u √Ω</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>‚Ä¢ Ph√≠ c√≥ th·ªÉ thay ƒë·ªïi n·∫øu s·ª≠a th√¥ng tin</li>
                                <li>‚Ä¢ B·∫£o hi·ªÉm c√≥ hi·ªáu l·ª±c sau thanh to√°n</li>
                                <li>‚Ä¢ H·ªó tr·ª£ t∆∞ v·∫•n: 1900-xxx-xxx</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: Payment -->
        <div id="step-4-content" class="step-content hidden">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-4">Thanh to√°n</h1>
                <p class="text-gray-600">Ho√†n t·∫•t thanh to√°n ƒë·ªÉ k√≠ch ho·∫°t b·∫£o hi·ªÉm</p>
            </div>

            <div class="grid lg:grid-cols-3 gap-8">
                <!-- Payment Methods -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-2xl shadow-lg p-8">
                        <h3 class="text-lg font-bold text-gray-800 mb-6">Ph∆∞∆°ng th·ª©c thanh to√°n</h3>

                        <!-- Payment Options -->
                        <div class="space-y-4 mb-8">

                            <!-- Bank Transfer -->
                            <div class="payment-method border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:border-green-500 transition duration-200" onclick="selectPaymentMethod('bank')">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4">
                                            <i class="fas fa-university text-green-600 text-xl"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-gray-800">Chuy·ªÉn kho·∫£n ng√¢n h√†ng</h4>
                                            <p class="text-sm text-gray-600">Chuy·ªÉn kho·∫£n tr·ª±c ti·∫øp</p>
                                        </div>
                                    </div>
                                    <input type="radio" name="payment" value="bank" class="w-5 h-5 text-green-600">
                                </div>
                            </div>

                        </div>

                        <!-- Payment Form -->

                        <form id="payment-form" class="hidden">

                            <!-- Bank Transfer Form -->
                            <div id="bank-form" class="hidden">
                                <h4 class="font-semibold text-gray-800 mb-4">Th√¥ng tin chuy·ªÉn kho·∫£n</h4>
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <div class="grid md:grid-cols-2 gap-4 text-sm">
                                        <div>
                                            <span class="font-semibold">Ng√¢n h√†ng:</span>
                                            <p>MB BANK - Chi nh√°nh H√† N·ªôi</p>
                                        </div>
                                        <div>
                                            <span class="font-semibold">S·ªë t√†i kho·∫£n:</span>
                                            <p>0325349348</p>
                                        </div>
                                        <div>
                                            <span class="font-semibold">Ch·ªß t√†i kho·∫£n:</span>
                                            <p>CONG TY VIETINSURANCE</p>
                                        </div>
                                        <div>
                                            <span class="font-semibold">S·ªë ti·ªÅn:</span>
                                            <p id="transfer-amount"></p>
                                        </div>
                                        <div>
                                            <span class="font-semibold">N·ªôi dung:</span>
                                            <p id="transfer-content"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </form>

                        <div class="mt-8 flex justify-between">
                            <button type="button" onclick="goToStep(3)" class="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-semibold hover:bg-gray-300 transition duration-200">
                                <i class="fas fa-arrow-left mr-2"></i>
                                Quay l·∫°i
                            </button>
                              <button
                                      id="payment-submit" onclick="processPayment()"
                                      class="bg-gradient-to-r from-green-600 to-emerald-600 text-white px-8 py-3 rounded-lg font-semibold hover:from-green-700 hover:to-emerald-700 transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                  <i class="fas fa-lock mr-2"></i>
                                  Thanh to√°n an to√†n
                              </button>

                        </div>
                    </div>
                </div>

                <!-- Order Summary -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-2xl shadow-lg p-6 sticky top-24">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Chi ti·∫øt thanh to√°n</h3>
                        <div id="final-order-summary">
                            <!-- Final order summary will be inserted here -->
                        </div>

                        <div class="mt-6 p-4 bg-green-50 rounded-lg">
                            <h4 class="font-semibold text-gray-800 mb-2">üõ°Ô∏è B·∫£o m·∫≠t thanh to√°n</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>‚Ä¢ M√£ h√≥a PCI DSS</li>
                                <li>‚Ä¢ X√°c th·ª±c 3D Secure</li>
                                <li>‚Ä¢ Ho√†n ti·ªÅn 100%</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 5: Contract -->
        <div id="step-5-content" class="step-content hidden">
            <div class="text-center mb-8">
                <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-check text-green-600 text-4xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-4">Thanh to√°n ƒëang ch·ªù x·ª≠ l√Ω !</h1>
                <p class="text-gray-600 mb-8">H·ª£p ƒë·ªìng b·∫£o hi·ªÉm ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng</p>
            </div>

            <!-- Contract Display -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">H·ª£p ƒë·ªìng b·∫£o hi·ªÉm</h2>
                    <div class="flex space-x-4">
                        <button onclick="printContract()" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700 transition duration-200">
                            <i class="fas fa-print mr-2"></i>
                            In h·ª£p ƒë·ªìng
                        </button>
                        <button onclick="downloadContract()" class="bg-green-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-green-700 transition duration-200">
                            <i class="fas fa-download mr-2"></i>
                            T·∫£i PDF
                        </button>
                    </div>
                </div>

                <!-- Contract Content -->
                <div id="contract-content" class="print-area">
                    <div class="border-2 border-gray-300 rounded-lg p-8">
                        <!-- Contract Header -->
                        <div class="text-center mb-8">
                            <div class="flex items-center justify-center mb-4">
                                <div class="w-16 h-16 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center mr-4">
                                    <i class="fas fa-shield-alt text-white text-2xl"></i>
                                </div>
                                <div>
                                    <h1 class="text-3xl font-bold text-gray-800">VietInsurance</h1>
                                    <p class="text-gray-600">C√¥ng ty B·∫£o hi·ªÉm Vi·ªát Nam</p>
                                </div>
                            </div>
                            <h2 class="text-2xl font-bold text-blue-600 mb-2">H·ª¢P ƒê·ªíNG B·∫¢O HI·ªÇM</h2>
                            <p class="text-gray-600">S·ªë h·ª£p ƒë·ªìng: <span id="contract-number" class="font-bold text-blue-600">VIE-2024-001234</span></p>
                        </div>

                        <!-- Contract Details -->
                        <div class="grid md:grid-cols-2 gap-8 mb-8">
                            <!-- Insurer Info -->
                            <div>
                                <h3 class="text-lg font-bold text-gray-800 mb-4">TH√îNG TIN B√äN B·∫¢O HI·ªÇM</h3>
                                <div class="space-y-2 text-sm">
                                    <p><strong>C√¥ng ty:</strong> VietInsurance Co., Ltd</p>
                                    <p><strong>ƒê·ªãa ch·ªâ:</strong> 123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM</p>
                                    <p><strong>ƒêi·ªán tho·∫°i:</strong> 1900-xxx-xxx</p>
                                    <p><strong>Email:</strong> info@vietinsurance.com</p>
                                    <p><strong>Gi·∫•y ph√©p:</strong> 123/GP-KDBH</p>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-gray-800 mb-4">TH√îNG TIN NG∆Ø·ªúI MUA B·∫¢O HI·ªÇM</h3>
                                <div id="contract-customer-info" class="space-y-2 text-sm">
                                    <!-- Customer info will be inserted here -->
                                </div>
                            </div>
                            <!-- Customer Info -->
                            <div>
                                <h3 class="text-lg font-bold text-gray-800 mb-4">TH√îNG TIN NG∆Ø·ªúI ƒê∆Ø·ª¢C B·∫¢O HI·ªÇM</h3>
                                <div id="contract-personalBenefic-info" class="space-y-2 text-sm">
                                    <!-- Customer info will be inserted here -->
                                </div>
                            </div>
                        </div>

                        <!-- Insurance Details -->
                        <div class="mb-8">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">CHI TI·∫æT B·∫¢O HI·ªÇM</h3>
                            <div id="contract-insurance-details" class="bg-gray-50 rounded-lg p-6">
                                <!-- Insurance details will be inserted here -->
                            </div>
                        </div>

                        <!-- Terms and Conditions -->
                        <div class="mb-8">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">ƒêI·ªÄU KHO·∫¢N V√Ä ƒêI·ªÄU KI·ªÜN</h3>
                            <div class="text-sm text-gray-700 space-y-2">
                                <p><strong>1. Hi·ªáu l·ª±c h·ª£p ƒë·ªìng:</strong> H·ª£p ƒë·ªìng c√≥ hi·ªáu l·ª±c t·ª´ 00:00 ng√†y <span id="contract-start-date"></span> ƒë·∫øn 24:00 ng√†y <span id="contract-end-date"></span>.</p>
                                <p><strong>2. Ph·∫°m vi b·∫£o hi·ªÉm:</strong> Theo ƒëi·ªÅu kho·∫£n b·∫£o hi·ªÉm ƒë√£ th·ªèa thu·∫≠n v√† quy ƒë·ªãnh c·ªßa ph√°p lu·∫≠t.</p>
                                <p><strong>3. Nghƒ©a v·ª• c·ªßa b√™n mua b·∫£o hi·ªÉm:</strong> Thanh to√°n ph√≠ b·∫£o hi·ªÉm ƒë·∫ßy ƒë·ªß, ƒë√∫ng h·∫°n v√† cung c·∫•p th√¥ng tin ch√≠nh x√°c.</p>
                                <p><strong>4. Quy·ªÅn l·ª£i c·ªßa b√™n mua b·∫£o hi·ªÉm:</strong> ƒê∆∞·ª£c b·ªìi th∆∞·ªùng theo quy ƒë·ªãnh khi x·∫£y ra r·ªßi ro ƒë∆∞·ª£c b·∫£o hi·ªÉm.</p>
                                <p><strong>5. Gi·∫£i quy·∫øt tranh ch·∫•p:</strong> C√°c tranh ch·∫•p s·∫Ω ƒë∆∞·ª£c gi·∫£i quy·∫øt th√¥ng qua th∆∞∆°ng l∆∞·ª£ng ho·∫∑c t·∫°i T√≤a √°n c√≥ th·∫©m quy·ªÅn.</p>
                            </div>
                        </div>

                        <!-- Signatures -->
                        <div class="grid md:grid-cols-2 gap-8 mt-12">
                            <div class="text-center">
                                <p class="font-bold text-gray-800 mb-4">B√äN MUA B·∫¢O HI·ªÇM</p>
                                <p class="text-sm text-gray-600 mb-8">(K√Ω t√™n v√† ghi r√µ h·ªç t√™n)</p>
                                <div class="border-t border-gray-300 pt-2">
                                    <p id="customer-signature" class="font-semibold"></p>
                                </div>
                            </div>
                            <div class="text-center">
                                <p class="font-bold text-gray-800 mb-4">B√äN B·∫¢O HI·ªÇM</p>
                                <p class="text-sm text-gray-600 mb-8">(K√Ω t√™n, ƒë√≥ng d·∫•u)</p>
                                <div class="border-t border-gray-300 pt-2">
                                    <p class="font-semibold">VietInsurance Co., Ltd</p>
                                </div>
                            </div>
                        </div>

                        <!-- Footer -->
                        <div class="text-center mt-8 pt-8 border-t border-gray-300">
                            <p class="text-sm text-gray-600">
                                H·ª£p ƒë·ªìng ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông v√†o ng√†y <span id="contract-created-date"></span><br>
                                Hotline h·ªó tr·ª£: 1900-xxx-xxx | Website: www.vietinsurance.com
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="text-center">
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button onclick="printContract()" class="bg-blue-600 text-white py-3 px-8 rounded-lg font-semibold hover:bg-blue-700 transition duration-200">
                        <i class="fas fa-print mr-2"></i>
                        In h·ª£p ƒë·ªìng
                    </button>
                    <button onclick="downloadContract()" class="bg-green-600 text-white py-3 px-8 rounded-lg font-semibold hover:bg-green-700 transition duration-200">
                        <i class="fas fa-download mr-2"></i>
                        T·∫£i h·ª£p ƒë·ªìng PDF
                    </button>
                    <button onclick="startOver()" class="bg-gray-200 text-gray-700 py-3 px-8 rounded-lg font-semibold hover:bg-gray-300 transition duration-200">
                        <i class="fas fa-plus mr-2"></i>
                        Mua th√™m b·∫£o hi·ªÉm
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div id="loadingModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4">
            <div class="text-center">
                <div class="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-4"></div>
                <h3 id="loading-title" class="text-xl font-bold text-gray-800 mb-2">ƒêang t√≠nh to√°n ph√≠ b·∫£o hi·ªÉm</h3>
                <p id="loading-message" class="text-gray-600">Vui l√≤ng ƒë·ª£i trong gi√¢y l√°t...</p>
            </div>
        </div>
    </div>


<script src="{% static 'js/payment.js' %}"></script>

{% endblock %}
