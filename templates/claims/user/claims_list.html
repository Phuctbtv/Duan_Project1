{% for claim in claims %}
    {% load humanize %}
<div class="claim-card {{ claim.claim_status }} bg-white rounded-xl shadow-lg p-6 card-hover" data-status="{{ claim.claim_status }}" >
    <div class="flex items-start justify-between mb-4">
        <div class="flex items-center space-x-4">
            <div class="w-12 h-12
                {% if claim.claim_status == 'pending' %} bg-orange-100 {% elif claim.claim_status == 'in_progress' %} bg-blue-100
                {% elif claim.claim_status == 'approved' %} bg-green-100 {% elif claim.claim_status == 'rejected' %} bg-red-100
                {% elif claim.claim_status == 'request_more' %} bg-red-100
                {% elif claim.claim_status == 'settled' %} bg-purple-100 {% endif %} rounded-lg flex items-center justify-center">
                <i class="fas
                    {% if claim.claim_status == 'pending' %} fa-file-medical text-orange-600
                    {% elif claim.claim_status == 'in_progress' %} fa-cog text-blue-600
                    {% elif claim.claim_status == 'approved' %} fa-check-circle text-green-600
                    {% elif claim.claim_status == 'rejected' %} fa-times-circle text-red-600
                    {% elif claim.claim_status == 'request_more' %} fa-times-circle text-red-600
                    {% elif claim.claim_status == 'settled' %} fa-medal text-purple-600 {% endif %} text-xl"></i>
            </div>
            <div>
                <h3 class="text-lg font-bold text-gray-800">#{{ claim.claim_number }}</h3>
                <p class="text-sm text-gray-600">{{ claim.policy.product.product_name }}</p>
            </div>
        </div>
        <div class="text-right">
            <div class="text-white px-3 py-1 rounded-full text-sm font-medium inline-flex items-center
                {% if claim.claim_status == 'pending' %} status-pending bg-orange-600
                {% elif claim.claim_status == 'processing' %} status-processing bg-blue-600
                {% elif claim.claim_status == 'approved' %} status-approved bg-green-600
                {% elif claim.claim_status == 'rejected' %} status-rejected bg-red-600
                {% elif claim.claim_status == 'request_more' %} status-rejected bg-red-600
                {% elif claim.claim_status == 'completed' %} status-completed bg-purple-600 {% endif %}">
                {% if claim.claim_status == 'pending' %}
                    <i class="fas fa-clock mr-1"></i>Chờ xử lý
                {% elif claim.claim_status == 'request_more' %}
                    <i class="fas fa-cog fa-spin mr-1"></i>Bổ sung tài liệu
                {% elif claim.claim_status == 'approved' %}
                    <i class="fas fa-check-circle mr-1"></i>Đã duyệt
                {% elif claim.claim_status == 'rejected' %}
                    <i class="fas fa-times-circle mr-1"></i>Từ chối
                {% elif claim.claim_status == 'settled' %}
                    <i class="fas fa-medal mr-1"></i>Hoàn thành
                {% endif %}
            </div>
            <div class="text-sm text-gray-500 mt-1">Ngày gửi yêu cầu: {{ claim.claim_date|date:"d/m/Y" }}</div>
        </div>
    </div>

    <div class="grid md:grid-cols-3 gap-4 mb-4">
        <div>
            <div class="text-sm text-gray-600">Số tiền yêu cầu</div>
            <div class="text-lg font-bold text-gray-800">{{ claim.requested_amount|floatformat:0|intcomma  }} VNĐ</div>
        </div>

        {% if claim.claim_status == 'approved' or claim.claim_status == 'settled' %}
        <div>
            <div class="text-sm text-gray-600">Số tiền được duyệt</div>
            <div class="text-lg font-bold text-green-600">{{ claim.approved_amount|default:"—"|floatformat:0|intcomma }} VNĐ</div>
        </div>
        {% endif %}

        {% if claim.claim_status == 'settled' %}
        <div>
            <div class="text-sm text-gray-600">Ngày hoàn thành</div>
            <div class="font-semibold text-gray-800">{{ claim.settlement_date|date:"d/m/Y" }}</div>
        </div>
        {% elif claim.claim_status == 'approved' %}
        <div>
            <div class="text-sm text-gray-600">Ngày duyệt</div>
            <div class="font-semibold text-gray-800">{{ claim.updated_at|date:"d/m/Y" }}</div>
        </div>
        {% else %}
        <div>
            <div class="text-sm text-gray-600">Ngày sự kiện</div>
            <div class="font-semibold text-gray-800">{{ claim.incident_date|date:"d/m/Y" }}</div>
        </div>
        {% endif %}
    </div>

    <div class="mb-4">
        <div class="flex items-center justify-between text-sm mb-2">
            <span class="text-gray-600">Tiến trình xử lý</span>
            <span class="{% if claim.claim_status == 'pending' %}text-orange-600{% elif claim.claim_status == 'in_progress' %}text-blue-600{% elif claim.claim_status == 'approved' %}text-green-600{% elif claim.claim_status == 'rejected' %}text-red-600{% elif claim.claim_status == 'settled' %}text-purple-600{% endif %} font-medium">
                {% if claim.claim_status == 'pending' %}25%{% elif claim.claim_status == 'in_progress' %}50%{% elif claim.claim_status == 'approved' %}100%{% elif claim.claim_status == 'rejected' %}Từ chối{% elif claim.claim_status == 'settled' %}Hoàn thành{% endif %}
            </span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill
                {% if claim.claim_status == 'pending' %} progress-pending
                {% elif claim.claim_status == 'in_progress' %} progress-processing
                {% elif claim.claim_status == 'approved' %} progress-approved
                {% elif claim.claim_status == 'rejected' %} progress-rejected
                {% elif claim.claim_status == 'settled' %} progress-completed {% endif %}">
            </div>
        </div>
    </div>

    {% if claim.claim_status == 'approved' %}
    <div class="bg-green-50 border border-green-200 rounded-lg p-3 mb-4">
        <div class="flex items-start space-x-2">
            <i class="fas fa-check-circle text-green-600 mt-0.5"></i>
            <div class="text-sm text-green-800">
                <strong>Đã duyệt:</strong> Số tiền bồi thường sẽ được chuyển vào tài khoản trong 3–5 ngày làm việc.
            </div>
        </div>
    </div>
    {% elif claim.claim_status == 'processing' %}
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
        <div class="flex items-start space-x-2">
            <i class="fas fa-info-circle text-blue-600 mt-0.5"></i>
            <div class="text-sm text-blue-800">
                <strong>Cập nhật mới nhất:</strong> Hồ sơ đang được thẩm định. Vui lòng chờ phản hồi.
            </div>
        </div>
    </div>
    {% elif claim.claim_status == 'rejected' %}
    <div class="bg-red-50 border border-red-200 rounded-lg p-3 mb-4">
        <div class="flex items-start space-x-2">
            <i class="fas fa-exclamation-triangle text-red-600 mt-0.5"></i>
            <div class="text-sm text-red-800">
                <strong>Lý do từ chối:</strong> {{ claim.rejection_reason|default:"Không xác định" }}
            </div>
        </div>
    </div>
    {% elif claim.claim_status == 'settled' %}
    <div class="bg-purple-50 border border-purple-200 rounded-lg p-3 mb-4">
        <div class="flex items-start space-x-2">
            <i class="fas fa-check-double text-purple-600 mt-0.5"></i>
            <div class="text-sm text-purple-800">
                <strong>Hoàn thành:</strong> Số tiền bồi thường đã được chuyển khoản thành công.
            </div>
        </div>
    </div>
    {% endif %}

    <div class="flex items-center justify-between">
        <div class="text-sm text-gray-600">
            <i class="fas fa-paperclip mr-1"></i>{{  claim.claim_documents.count |default:0 }} tài liệu đính kèm
        </div>
        <div class="flex space-x-2">
            <a type="button" href="{% url 'detail_claims' claim.id %}" class="text-blue-600 hover:text-blue-700 font-medium text-sm" >
                <i class="fas fa-eye mr-1"></i>Xem chi tiết
            </a>

            {% if claim.claim_status == 'rejected' %}
                <button class="text-orange-600 hover:text-orange-700 font-medium text-sm">
                    <i class="fas fa-gavel mr-1"></i>Khiếu nại
                </button>
            {% elif claim.claim_status == 'approved' %}
                <button class="text-green-600 hover:text-green-700 font-medium text-sm">
                    <i class="fas fa-download mr-1"></i>Tải quyết định
                </button>
            {% elif claim.claim_status == 'settled' %}
                <button class="text-green-600 hover:text-green-700 font-medium text-sm">
                    <i class="fas fa-star mr-1"></i>Đánh giá
                </button>
            {% endif %}
        </div>
    </div>
</div>
{% empty %}
<p class="text-gray-500 text-center">Không có yêu cầu nào phù hợp.</p>
{% endfor %}
<!-- Pagination -->
{% if page_obj.has_other_pages %}
<div class="flex items-center justify-between mt-6">
    <div class="text-sm text-gray-600">
        Trang {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
    </div>

    <div class="flex space-x-2">
        <!-- Nút Previous -->
        <button
            class="px-3 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 {% if not page_obj.has_previous %}opacity-50 cursor-not-allowed{% endif %}"
            {% if page_obj.has_previous %}
                onclick="loadClaims({{ page_obj.previous_page_number }})"
            {% endif %}
        >
            <i class="fas fa-chevron-left"></i>
        </button>

        <!-- Các số trang -->
        {% for num in page_obj.paginator.page_range %}
            {% if num == page_obj.number %}
                <button class="px-3 py-2 bg-blue-600 text-white rounded-lg">{{ num }}</button>
            {% else %}
                <button class="px-3 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50"
                        onclick="loadClaims({{ num }})">{{ num }}</button>
            {% endif %}
        {% endfor %}

        <!-- Nút Next -->
        <button
            class="px-3 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 {% if not page_obj.has_next %}opacity-50 cursor-not-allowed{% endif %}"
            {% if page_obj.has_next %}
                onclick="loadClaims({{ page_obj.next_page_number }})"
            {% endif %}
        >
            <i class="fas fa-chevron-right"></i>
        </button>
    </div>
</div>
{% endif %}