{% extends 'admin/admin_home.html' %}
{% load static %}
{% load humanize %}

{% block content %}
<div class="section p-6 max-w-6xl mx-auto">
    <h2 class="text-3xl font-bold text-gray-800 mb-8">üë§ H·ªì S∆° ƒê·∫°i L√Ω: {{ user.get_full_name }}</h2>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

        <div class="lg:col-span-1 space-y-6">

            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                <h3 class="text-xl font-semibold text-gray-700 mb-4 flex items-center space-x-2">
                    <i class="fas fa-user-circle text-blue-500"></i>
                    <span>Th√¥ng Tin C∆° B·∫£n</span>
                </h3>
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between border-b pb-2">
                        <strong class="text-gray-600">M√£ ƒë·∫°i l√Ω:</strong>
                        <span class="font-bold text-blue-600">{{ agent.code }}</span>
                    </div>
                    <div class="flex justify-between border-b pb-2">
                        <strong class="text-gray-600">T√™n ƒëƒÉng nh·∫≠p:</strong>
                        <span>{{ user.username }}</span>
                    </div>
                    <div class="flex justify-between border-b pb-2">
                        <strong class="text-gray-600">H·ªç t√™n:</strong>
                        <span>{{ user.get_full_name }}</span>
                    </div>
                    <div class="flex justify-between border-b pb-2">
                        <strong class="text-gray-600">Email:</strong>
                        <span>{{ user.email|default:"‚Äî" }}</span>
                    </div>
                    <div class="flex justify-between">
                        <strong class="text-gray-600">S·ªë ƒëi·ªán tho·∫°i:</strong>
                        <span>{{ user.phone_number|default:"‚Äî" }}</span>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                <h3 class="text-xl font-semibold text-gray-700 mb-4 flex items-center space-x-2">
                    <i class="fas fa-university text-green-500"></i>
                    <span>Th√¥ng Tin Thanh To√°n</span>
                </h3>
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between border-b pb-2">
                        <strong class="text-gray-600">Ng√¢n h√†ng:</strong>
                        <span>{{ agent.bank_name|default:"‚Äî" }}</span>
                    </div>
                    <div class="flex justify-between border-b pb-2">
                        <strong class="text-gray-600">S·ªë t√†i kho·∫£n:</strong>
                        <span class="font-mono">{{ agent.bank_account_number|default:"‚Äî" }}</span>
                    </div>
                    <div class="flex justify-between">
                        <strong class="text-gray-600">Ch·ªß t√†i kho·∫£n:</strong>
                        <span>{{ agent.bank_account_holder|default:"‚Äî" }}</span>
                    </div>
                </div>
            </div>

             <div class="flex justify-between space-x-4 mt-4 p-4 bg-gray-50 rounded-xl shadow-inner">
                <a href="{% url 'agent_edit' user.id %}" class="flex-1 text-center px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition duration-150">
                    <i class="fas fa-edit mr-1"></i> Ch·ªânh S·ª≠a
                </a>
                <a href="{% url 'custom_section' %}" class="flex-1 text-center px-4 py-2 rounded-lg bg-gray-600 text-white hover:bg-gray-700 transition duration-150">
                    <i class="fas fa-arrow-left mr-1"></i> Quay L·∫°i
                </a>
            </div>

        </div> <div class="lg:col-span-2">
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                <h3 class="text-xl font-semibold text-gray-700 mb-4 flex items-center space-x-2">
                    <i class="fas fa-file-contract text-red-500"></i>
                    <span>Danh S√°ch H·ª£p ƒê·ªìng ƒê·∫°i L√Ω ƒêang Qu·∫£n L√Ω</span>
                </h3>

                {% if servicing_policies %}
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">M√£ Hƒê</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kh√°ch h√†ng</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">S·∫£n ph·∫©m</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ph√≠ (VNƒê)</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tr·∫°ng th√°i</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">H√†nh ƒë·ªông</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for policy in servicing_policies %}
                            <tr class="hover:bg-gray-50">
                                <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">{{ policy.policy_number }}</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">{{ policy.customer.user.get_full_name }}</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">{{ policy.product.product_name }}</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 text-right font-semibold">{{ policy.premium_amount|floatformat:0|intcomma }}</td>
                                <td class="px-4 py-3 whitespace-nowrap">
                                    {% if policy.policy_status == 'active' %}
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Ho·∫°t ƒë·ªông</span>
                                    {% elif policy.policy_status == 'pending' %}
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-orange-100 text-orange-800">Ch·ªù duy·ªát</span>
                                    {% else %}
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">ƒê√£ h·ªßy</span>
                                    {% endif %}
                                </td>
                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm font-medium">
                                    <a href="{% url 'policy_detail' policy.pk %}" class="text-indigo-600 hover:text-indigo-900 transition duration-150">Xem chi ti·∫øt</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-8 text-gray-500 bg-gray-50 rounded-lg border-dashed border-2 border-gray-200">
                    <p>ƒê·∫°i l√Ω n√†y hi·ªán ch∆∞a qu·∫£n l√Ω h·ª£p ƒë·ªìng n√†o.</p>
                </div>
                {% endif %}
            </div>
        </div> </div>
</div>
{% endblock %}